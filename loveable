--[[
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    LOVEABLE UI LIBRARY FOR ROBLOX
    Version: 1.0.0
    
    The most customizable and user-friendly launcher library for Roblox exploiting.
    Features: Apps, Pages, Notifications, Themes, and more!
    
    Upload this to GitHub: https://github.com/YOUR_USERNAME/YOUR_REPO/main/Loveable.lua
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
]]

local Loveable = {}
Loveable.__index = Loveable

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Utility Functions
local function CreateInstance(className, properties)
    local instance = Instance.new(className)
    for property, value in pairs(properties) do
        if property ~= "Parent" then instance[property] = value end
    end
    if properties.Parent then instance.Parent = properties.Parent end
    return instance
end

local function Tween(object, properties, duration, easingStyle, easingDirection)
    return TweenService:Create(object, TweenInfo.new(duration or 0.3, easingStyle or Enum.EasingStyle.Quint, easingDirection or Enum.EasingDirection.Out), properties):Play()
end

local function CreateCorner(parent, radius)
    return CreateInstance("UICorner", {CornerRadius = UDim.new(0, radius or 8), Parent = parent})
end

local function CreateStroke(parent, color, thickness, transparency)
    return CreateInstance("UIStroke", {Color = color or Color3.fromRGB(60, 60, 60), Thickness = thickness or 1, Transparency = transparency or 0.5, ApplyStrokeMode = Enum.ApplyStrokeMode.Border, Parent = parent})
end

-- Default Theme
local DefaultTheme = {
    -- Panel
    PanelBackground = Color3.fromRGB(32, 32, 32),
    PanelTransparency = 0.25,
    PanelBorder = Color3.fromRGB(55, 55, 55),
    PanelBorderThickness = 1.5,
    PanelBorderTransparency = 0.5,
    PanelCornerRadius = 20,
    PanelWidth = 570,
    PanelHeight = 360,
    
    -- Search Bar
    SearchBackground = Color3.fromRGB(18, 18, 18),
    SearchTransparency = 0.1,
    SearchTextColor = Color3.fromRGB(180, 180, 180),
    SearchPlaceholderColor = Color3.fromRGB(100, 100, 100),
    SearchIconColor = Color3.fromRGB(120, 120, 120),
    SearchCornerRadius = 20,
    SearchBarWidth = 260,
    SearchBarHeight = 40,
    
    -- Apps
    AppIconBackground = Color3.fromRGB(40, 40, 40),
    AppIconSize = 32,
    AppIconCornerRadius = 6,
    AppTextColor = Color3.fromRGB(200, 200, 200),
    AppTextHoverColor = Color3.fromRGB(240, 240, 240),
    AppSpacing = 3,
    AppHeight = 45,
    AppsContainerWidth = 260,
    
    -- Bottom Controls
    ControlBackground = Color3.fromRGB(25, 25, 25),
    ControlTransparency = 0.2,
    ControlHoverTransparency = 0,
    ControlIconColor = Color3.fromRGB(150, 150, 150),
    ControlSize = 35,
    ControlCornerRadius = 8,
    ControlSpacing = 8,
    
    -- Labels
    LabelTextColor = Color3.fromRGB(130, 130, 130),
    LabelTextSize = 13,
    
    -- Close Button
    CloseBackground = Color3.fromRGB(30, 30, 30),
    CloseHoverBackground = Color3.fromRGB(180, 50, 50),
    CloseTextColor = Color3.fromRGB(160, 160, 160),
    
    -- Fonts
    FontRegular = Enum.Font.Gotham,
    FontMedium = Enum.Font.GothamMedium,
    FontBold = Enum.Font.GothamBold,
    
    -- Animations
    AnimationDuration = 0.35,
    AnimationEasing = Enum.EasingStyle.Quint,
    HoverDuration = 0.15,
}

-- Mandatory Notifications
local MandatoryNotifications = {
    {Title = "Loveable UI", Message = "Thanks for using Loveable! The most customizable UI library.", Icon = "ðŸ’", Duration = 5},
    {Title = "Pro Tip", Message = "Use the search bar to quickly find apps and features.", Icon = "ðŸ’¡", Duration = 5},
    {Title = "Customization", Message = "Everything in Loveable can be customized to your liking!", Icon = "ðŸŽ¨", Duration = 5},
}

function Loveable:Create(config)
    local self = setmetatable({}, Loveable)
    
    -- Configuration
    self.Config = {
        Keybind = config.Keybind or Enum.KeyCode.RightControl,
        Apps = config.Apps or {},
        Pages = config.Pages or {}, -- NEW: Pages system
        BottomControls = config.BottomControls or {},
        CustomNotifications = config.Notifications or {},
        NotificationInterval = config.NotificationInterval or 120,
        Theme = config.Theme or {},
        ShowBottomLabel = config.ShowBottomLabel ~= false,
        BottomLabelText = config.BottomLabelText or "Loveable",
        Key = config.Key, -- Optional key system
    }
    
    -- Merge theme with defaults
    for key, value in pairs(DefaultTheme) do
        if self.Config.Theme[key] == nil then
            self.Config.Theme[key] = value
        end
    end
    
    -- State
    self.Opened = false
    self.SearchQuery = ""
    self.CurrentPage = nil -- Tracks current open page
    self.AllNotifications = {} -- Combined mandatory + custom
    
    -- Combine notifications
    for _, notif in ipairs(MandatoryNotifications) do
        table.insert(self.AllNotifications, notif)
    end
    for _, notif in ipairs(self.Config.CustomNotifications) do
        table.insert(self.AllNotifications, notif)
    end
    
    -- Create UI
    self:CreateUI()
    self:SetupKeybind()
    
    -- Check key system if enabled
    if self.Config.Key then
        self:ShowKeySystem(function(success)
            if success then
                -- Show intro animation (MANDATORY)
                self:PlayIntroAnimation()
                
                -- Start notifications automatically
                if #self.AllNotifications > 0 then
                    self:StartNotifications(self.AllNotifications, self.Config.NotificationInterval)
                end
            else
                -- Invalid key - destroy UI
                self:Destroy()
                warn("âŒ Invalid key! Access denied.")
            end
        end)
    else
        -- No key system - show intro and start normally (MANDATORY)
        self:PlayIntroAnimation()
        
        -- Start notifications automatically
        if #self.AllNotifications > 0 then
            self:StartNotifications(self.AllNotifications, self.Config.NotificationInterval)
        end
    end
    
    return self
end

function Loveable:CreateUI()
    local theme = self.Config.Theme
    
    -- Screen GUI
    self.ScreenGui = CreateInstance("ScreenGui", {
        Name = "LoveableUI_" .. tostring(math.random(1000, 9999)),
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        DisplayOrder = 999999
    })
    
    pcall(function() self.ScreenGui.Parent = game:GetService("CoreGui") end)
    if not self.ScreenGui.Parent then
        self.ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
    end
    
    -- Blur Effect (always enabled)
    self.BlurEffect = CreateInstance("BlurEffect", {
        Size = 0,
        Parent = game:GetService("Lighting")
    })
    
    -- Main Frame
    self.MainFrame = CreateInstance("Frame", {
        Name = "MainFrame",
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Visible = false,
        Parent = self.ScreenGui
    })
    
    -- Panel
    self.Panel = CreateInstance("Frame", {
        Name = "Panel",
        Size = UDim2.new(0, 0, 0, 0),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundColor3 = theme.PanelBackground,
        BackgroundTransparency = theme.PanelTransparency,
        BorderSizePixel = 0,
        ClipsDescendants = false,
        Parent = self.MainFrame
    })
    CreateCorner(self.Panel, theme.PanelCornerRadius)
    CreateStroke(self.Panel, theme.PanelBorder, theme.PanelBorderThickness, theme.PanelBorderTransparency)
    
    -- Create UI components
    self:CreateSearchBar()
    self:CreateAppsSection()
    self:CreateBottomBar()
    self:CreateCloseButton()
end

function Loveable:CreateSearchBar()
    local theme = self.Config.Theme
    
    self.SearchBar = CreateInstance("Frame", {
        Name = "SearchBar",
        Size = UDim2.new(0, theme.SearchBarWidth, 0, theme.SearchBarHeight),
        Position = UDim2.new(0, 20, 0, 20),
        BackgroundColor3 = theme.SearchBackground,
        BackgroundTransparency = theme.SearchTransparency,
        BorderSizePixel = 0,
        Parent = self.Panel
    })
    CreateCorner(self.SearchBar, theme.SearchCornerRadius)
    
    self.SearchIcon = CreateInstance("TextLabel", {
        Name = "SearchIcon",
        Size = UDim2.new(0, 25, 0, 25),
        Position = UDim2.new(0, 12, 0, 8),
        BackgroundTransparency = 1,
        Text = "â†’|",
        TextSize = 16,
        TextColor3 = theme.SearchIconColor,
        Font = Enum.Font.Code,
        TextXAlignment = Enum.TextXAlignment.Center,
        Parent = self.SearchBar
    })
    
    self.SearchBox = CreateInstance("TextBox", {
        Name = "SearchBox",
        Size = UDim2.new(1, -45, 1, 0),
        Position = UDim2.new(0, 40, 0, 0),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Text = "",
        PlaceholderText = "",
        TextColor3 = theme.SearchTextColor,
        PlaceholderColor3 = theme.SearchPlaceholderColor,
        TextSize = 14,
        Font = theme.FontRegular,
        TextXAlignment = Enum.TextXAlignment.Left,
        ClearTextOnFocus = false,
        Parent = self.SearchBar
    })
    
    self.SearchBox:GetPropertyChangedSignal("Text"):Connect(function()
        self:FilterApps(self.SearchBox.Text)
    end)
end

function Loveable:CreateAppsSection()
    local theme = self.Config.Theme
    
    self.AppsContainer = CreateInstance("Frame", {
        Name = "AppsContainer",
        Size = UDim2.new(0, theme.AppsContainerWidth, 1, -140),
        Position = UDim2.new(1, -280, 0, 20),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Parent = self.Panel
    })
    
    self.AppsScroll = CreateInstance("ScrollingFrame", {
        Name = "AppsScroll",
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        ScrollBarThickness = 0,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollingDirection = Enum.ScrollingDirection.Y,
        Parent = self.AppsContainer
    })
    
    self.AppsLayout = CreateInstance("UIListLayout", {
        Name = "AppsLayout",
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, theme.AppSpacing),
        Parent = self.AppsScroll
    })
    
    self.AppsLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        self.AppsScroll.CanvasSize = UDim2.new(0, 0, 0, self.AppsLayout.AbsoluteContentSize.Y)
    end)
    
    self:PopulateApps()
end

function Loveable:CreateAppItem(appData, index)
    local theme = self.Config.Theme
    
    local AppFrame = CreateInstance("Frame", {
        Name = "AppFrame_" .. (appData.Name or "App"),
        Size = UDim2.new(1, 0, 0, theme.AppHeight),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        LayoutOrder = index,
        Parent = self.AppsScroll
    })
    
    -- Icon Background
    local IconBg = CreateInstance("Frame", {
        Name = "IconBg",
        Size = UDim2.new(0, theme.AppIconSize, 0, theme.AppIconSize),
        Position = UDim2.new(0, 5, 0, (theme.AppHeight - theme.AppIconSize) / 2),
        BackgroundColor3 = theme.AppIconBackground,
        BorderSizePixel = 0,
        Parent = AppFrame
    })
    CreateCorner(IconBg, theme.AppIconCornerRadius)
    
    -- Icon
    if appData.Icon then
        if type(appData.Icon) == "string" and string.find(appData.Icon, "rbxassetid://") then
            CreateInstance("ImageLabel", {
                Name = "IconImage",
                Size = UDim2.new(0.75, 0, 0.75, 0),
                Position = UDim2.new(0.125, 0, 0.125, 0),
                BackgroundTransparency = 1,
                Image = appData.Icon,
                ScaleType = Enum.ScaleType.Fit,
                Parent = IconBg
            })
        else
            CreateInstance("TextLabel", {
                Name = "IconText",
                Size = UDim2.new(1, 0, 1, 0),
                BackgroundTransparency = 1,
                Text = appData.Icon,
                TextSize = 18,
                TextColor3 = Color3.fromRGB(200, 200, 200),
                Font = theme.FontRegular,
                TextXAlignment = Enum.TextXAlignment.Center,
                TextYAlignment = Enum.TextYAlignment.Center,
                Parent = IconBg
            })
        end
    end
    
    -- App Name
    local AppName = CreateInstance("TextLabel", {
        Name = "AppName",
        Size = UDim2.new(1, -50, 1, 0),
        Position = UDim2.new(0, 45, 0, 0),
        BackgroundTransparency = 1,
        Text = appData.Name or "Unnamed App",
        TextSize = 14,
        TextColor3 = theme.AppTextColor,
        Font = theme.FontRegular,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Center,
        TextTruncate = Enum.TextTruncate.AtEnd,
        Parent = AppFrame
    })
    
    -- Description
    if appData.Description then
        AppName.Size = UDim2.new(1, -50, 0, 16)
        AppName.Position = UDim2.new(0, 45, 0, 8)
        AppName.TextYAlignment = Enum.TextYAlignment.Top
        
        CreateInstance("TextLabel", {
            Name = "AppDesc",
            Size = UDim2.new(1, -50, 0, 14),
            Position = UDim2.new(0, 45, 0, 26),
            BackgroundTransparency = 1,
            Text = appData.Description,
            TextSize = 11,
            TextColor3 = Color3.fromRGB(140, 140, 140),
            Font = theme.FontRegular,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextYAlignment = Enum.TextYAlignment.Top,
            TextTruncate = Enum.TextTruncate.AtEnd,
            Parent = AppFrame
        })
    end
    
    -- Button
    local AppButton = CreateInstance("TextButton", {
        Name = "AppButton",
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Text = "",
        AutoButtonColor = false,
        Parent = AppFrame
    })
    
    AppButton.MouseEnter:Connect(function()
        Tween(AppName, {TextColor3 = theme.AppTextHoverColor}, theme.HoverDuration)
    end)
    
    AppButton.MouseLeave:Connect(function()
        Tween(AppName, {TextColor3 = theme.AppTextColor}, theme.HoverDuration)
    end)
    
    AppButton.MouseButton1Click:Connect(function()
        if appData.Callback then
            pcall(appData.Callback)
        end
        if appData.CloseOnClick ~= false then
            self:Close()
        end
    end)
end

function Loveable:PopulateApps()
    -- Clear existing apps
    for _, child in pairs(self.AppsScroll:GetChildren()) do
        if child:IsA("Frame") and child.Name:match("^AppFrame_") then
            child:Destroy()
        end
    end
    
    -- Filter apps
    local appsToShow = {}
    if self.SearchQuery ~= "" then
        for _, appData in ipairs(self.Config.Apps) do
            if self:AppMatchesSearch(appData, self.SearchQuery) then
                table.insert(appsToShow, appData)
            end
        end
    else
        appsToShow = self.Config.Apps
    end
    
    -- Create app items
    for index, appData in ipairs(appsToShow) do
        self:CreateAppItem(appData, index)
    end
    
    -- Show "no results" message
    if #appsToShow == 0 and self.SearchQuery ~= "" then
        CreateInstance("TextLabel", {
            Name = "NoResults",
            Size = UDim2.new(1, 0, 0, 60),
            BackgroundTransparency = 1,
            Text = "No apps found",
            TextSize = 14,
            TextColor3 = Color3.fromRGB(120, 120, 120),
            Font = self.Config.Theme.FontRegular,
            TextXAlignment = Enum.TextXAlignment.Center,
            Parent = self.AppsScroll
        })
    end
end

function Loveable:AppMatchesSearch(appData, query)
    query = query:lower()
    if string.find((appData.Name or ""):lower(), query, 1, true) then return true end
    if appData.Description and string.find(appData.Description:lower(), query, 1, true) then return true end
    if appData.Tags then
        for _, tag in ipairs(appData.Tags) do
            if string.find(tag:lower(), query, 1, true) then return true end
        end
    end
    return false
end

function Loveable:FilterApps(query)
    self.SearchQuery = query or ""
    self:PopulateApps()
end

function Loveable:CreateBottomBar()
    local theme = self.Config.Theme
    
    self.BottomBar = CreateInstance("Frame", {
        Name = "BottomBar",
        Size = UDim2.new(1, -40, 0, 50),
        Position = UDim2.new(0, 20, 1, -65),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Parent = self.Panel
    })
    
    self.ControlsContainer = CreateInstance("Frame", {
        Name = "ControlsContainer",
        Size = UDim2.new(0, 0, 0, theme.ControlSize),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Parent = self.BottomBar
    })
    
    local ControlsLayout = CreateInstance("UIListLayout", {
        Name = "ControlsLayout",
        FillDirection = Enum.FillDirection.Horizontal,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, theme.ControlSpacing),
        Parent = self.ControlsContainer
    })
    
    ControlsLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        self.ControlsContainer.Size = UDim2.new(0, ControlsLayout.AbsoluteContentSize.X, 0, theme.ControlSize)
    end)
    
    -- Create bottom controls
    for index, controlData in ipairs(self.Config.BottomControls) do
        self:CreateControlButton(controlData, index)
    end
    
    -- Bottom label
    if self.Config.ShowBottomLabel then
        self.BottomLabel = CreateInstance("TextLabel", {
            Name = "BottomLabel",
            Size = UDim2.new(0, 100, 0, theme.ControlSize),
            Position = UDim2.new(1, -100, 0, 0),
            BackgroundTransparency = 1,
            Text = self.Config.BottomLabelText,
            TextSize = theme.LabelTextSize,
            TextColor3 = theme.LabelTextColor,
            Font = theme.FontRegular,
            TextXAlignment = Enum.TextXAlignment.Right,
            TextYAlignment = Enum.TextYAlignment.Center,
            Parent = self.BottomBar
        })
    end
end

function Loveable:CreateControlButton(controlData, index)
    local theme = self.Config.Theme
    
    local ControlBtn = CreateInstance("Frame", {
        Name = "Control_" .. (controlData.Name or index),
        Size = UDim2.new(0, theme.ControlSize, 0, theme.ControlSize),
        BackgroundColor3 = theme.ControlBackground,
        BackgroundTransparency = theme.ControlTransparency,
        BorderSizePixel = 0,
        LayoutOrder = index,
        Parent = self.ControlsContainer
    })
    CreateCorner(ControlBtn, theme.ControlCornerRadius)
    
    CreateInstance("TextLabel", {
        Name = "ControlIcon",
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        Text = controlData.Icon or "?",
        TextSize = 16,
        TextColor3 = theme.ControlIconColor,
        Font = theme.FontRegular,
        TextXAlignment = Enum.TextXAlignment.Center,
        TextYAlignment = Enum.TextYAlignment.Center,
        Parent = ControlBtn
    })
    
    local ControlButton = CreateInstance("TextButton", {
        Name = "ControlButton",
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Text = "",
        AutoButtonColor = false,
        Parent = ControlBtn
    })
    
    ControlButton.MouseEnter:Connect(function()
        Tween(ControlBtn, {BackgroundTransparency = theme.ControlHoverTransparency}, theme.HoverDuration)
    end)
    
    ControlButton.MouseLeave:Connect(function()
        Tween(ControlBtn, {BackgroundTransparency = theme.ControlTransparency}, theme.HoverDuration)
    end)
    
    ControlButton.MouseButton1Click:Connect(function()
        if controlData.PageName then
            -- Open the page
            self:OpenPage(controlData.PageName)
        elseif controlData.Callback then
            pcall(controlData.Callback)
        end
    end)
end

function Loveable:CreateCloseButton()
    local theme = self.Config.Theme
    
    self.CloseButton = CreateInstance("TextButton", {
        Name = "CloseButton",
        Size = UDim2.new(0, 30, 0, 30),
        Position = UDim2.new(1, -40, 0, 15),
        BackgroundColor3 = theme.CloseBackground,
        BackgroundTransparency = 0.2,
        BorderSizePixel = 0,
        Text = "âœ•",
        TextSize = 16,
        TextColor3 = theme.CloseTextColor,
        Font = theme.FontBold,
        AutoButtonColor = false,
        Parent = self.Panel
    })
    CreateCorner(self.CloseButton, 6)
    
    self.CloseButton.MouseEnter:Connect(function()
        Tween(self.CloseButton, {BackgroundColor3 = theme.CloseHoverBackground}, 0.2)
    end)
    
    self.CloseButton.MouseLeave:Connect(function()
        Tween(self.CloseButton, {BackgroundColor3 = theme.CloseBackground}, 0.2)
    end)
    
    self.CloseButton.MouseButton1Click:Connect(function() self:Close() end)
end

function Loveable:OpenPage(pageName)
    -- Find the page
    local pageData = nil
    for _, page in ipairs(self.Config.Pages) do
        if page.Name == pageName then
            pageData = page
            break
        end
    end
    
    if not pageData then
        warn("Page not found: " .. pageName)
        return
    end
    
    local theme = self.Config.Theme
    
    -- Create separate ScreenGui for the page
    local PageGui = CreateInstance("ScreenGui", {
        Name = "LoveablePage_" .. pageName,
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        DisplayOrder = 999999,
        Parent = self.ScreenGui.Parent
    })
    
    -- Page Window (draggable)
    local PageWindow = CreateInstance("Frame", {
        Name = "PageWindow",
        Size = UDim2.new(0, theme.PanelWidth, 0, theme.PanelHeight),
        Position = UDim2.new(0.5, 50, 0.5, 50), -- Offset from main UI
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundColor3 = theme.PanelBackground,
        BackgroundTransparency = theme.PanelTransparency,
        BorderSizePixel = 0,
        Parent = PageGui
    })
    CreateCorner(PageWindow, theme.PanelCornerRadius)
    CreateStroke(PageWindow, theme.PanelBorder, theme.PanelBorderThickness, theme.PanelBorderTransparency)
    
    -- Title Bar (for dragging)
    local TitleBar = CreateInstance("Frame", {
        Name = "TitleBar",
        Size = UDim2.new(1, 0, 0, 40),
        Position = UDim2.new(0, 0, 0, 0),
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        BackgroundTransparency = 0.97,
        BorderSizePixel = 0,
        Parent = PageWindow
    })
    CreateCorner(TitleBar, theme.PanelCornerRadius)
    
    -- Title Text
    CreateInstance("TextLabel", {
        Size = UDim2.new(1, -50, 1, 0),
        Position = UDim2.new(0, 15, 0, 0),
        BackgroundTransparency = 1,
        Text = pageName,
        TextSize = 16,
        TextColor3 = Color3.fromRGB(255, 255, 255),
        Font = Enum.Font.GothamBold,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = TitleBar
    })
    
    -- Close Button
    local PageCloseButton = CreateInstance("TextButton", {
        Name = "CloseButton",
        Size = UDim2.new(0, 30, 0, 30),
        Position = UDim2.new(1, -35, 0, 5),
        BackgroundColor3 = theme.CloseBackground,
        BackgroundTransparency = 0.2,
        BorderSizePixel = 0,
        Text = "âœ•",
        TextSize = 16,
        TextColor3 = theme.CloseTextColor,
        Font = theme.FontBold,
        AutoButtonColor = false,
        Parent = TitleBar
    })
    CreateCorner(PageCloseButton, 6)
    
    PageCloseButton.MouseEnter:Connect(function()
        Tween(PageCloseButton, {BackgroundColor3 = theme.CloseHoverBackground}, 0.2)
    end)
    PageCloseButton.MouseLeave:Connect(function()
        Tween(PageCloseButton, {BackgroundColor3 = theme.CloseBackground}, 0.2)
    end)
    PageCloseButton.MouseButton1Click:Connect(function()
        PageGui:Destroy()
    end)
    
    -- Content Container
    local ContentContainer = CreateInstance("Frame", {
        Name = "ContentContainer",
        Size = UDim2.new(1, -40, 1, -60),
        Position = UDim2.new(0, 20, 0, 50),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Parent = PageWindow
    })
    
    -- Create page content
    if pageData.CreateContent then
        pcall(pageData.CreateContent, ContentContainer)
    end
    
    -- Setup dragging
    local dragging = false
    local dragInput
    local dragStart
    local startPos
    
    TitleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = PageWindow.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    TitleBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            PageWindow.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end)
end

function Loveable:ShowKeySystem(callback)
    -- Create key system GUI
    local KeyGui = CreateInstance("ScreenGui", {
        Name = "LoveableKeySystem",
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        DisplayOrder = 999997,
        Parent = self.ScreenGui.Parent
    })
    
    -- Background
    local Background = CreateInstance("Frame", {
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Color3.fromRGB(0, 0, 0),
        BackgroundTransparency = 0.5,
        BorderSizePixel = 0,
        Parent = KeyGui
    })
    
    -- Key Panel
    local KeyPanel = CreateInstance("Frame", {
        Size = UDim2.new(0, 400, 0, 250),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundColor3 = Color3.fromRGB(25, 25, 25),
        BorderSizePixel = 0,
        Parent = Background
    })
    CreateCorner(KeyPanel, 12)
    CreateStroke(KeyPanel, Color3.fromRGB(60, 60, 60), 2, 0.5)
    
    -- Title
    CreateInstance("TextLabel", {
        Size = UDim2.new(1, -40, 0, 40),
        Position = UDim2.new(0, 20, 0, 20),
        BackgroundTransparency = 1,
        Text = "ðŸ”‘ Key System",
        TextSize = 24,
        TextColor3 = Color3.fromRGB(255, 255, 255),
        Font = Enum.Font.GothamBold,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = KeyPanel
    })
    
    -- Description
    CreateInstance("TextLabel", {
        Size = UDim2.new(1, -40, 0, 30),
        Position = UDim2.new(0, 20, 0, 65),
        BackgroundTransparency = 1,
        Text = "Enter your key to access Loveable",
        TextSize = 14,
        TextColor3 = Color3.fromRGB(180, 180, 180),
        Font = Enum.Font.Gotham,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = KeyPanel
    })
    
    -- Key Input
    local KeyInput = CreateInstance("TextBox", {
        Size = UDim2.new(1, -40, 0, 45),
        Position = UDim2.new(0, 20, 0, 105),
        BackgroundColor3 = Color3.fromRGB(35, 35, 35),
        BorderSizePixel = 0,
        Text = "",
        PlaceholderText = "Enter key here...",
        TextColor3 = Color3.fromRGB(255, 255, 255),
        PlaceholderColor3 = Color3.fromRGB(100, 100, 100),
        TextSize = 14,
        Font = Enum.Font.Gotham,
        ClearTextOnFocus = false,
        Parent = KeyPanel
    })
    CreateCorner(KeyInput, 8)
    
    -- Submit Button
    local SubmitButton = CreateInstance("TextButton", {
        Size = UDim2.new(1, -40, 0, 45),
        Position = UDim2.new(0, 20, 0, 165),
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        BorderSizePixel = 0,
        Text = "Submit Key",
        TextSize = 16,
        TextColor3 = Color3.fromRGB(0, 0, 0),
        Font = Enum.Font.GothamBold,
        AutoButtonColor = false,
        Parent = KeyPanel
    })
    CreateCorner(SubmitButton, 8)
    
    -- Status Label
    local StatusLabel = CreateInstance("TextLabel", {
        Size = UDim2.new(1, -40, 0, 20),
        Position = UDim2.new(0, 20, 0, 220),
        BackgroundTransparency = 1,
        Text = "",
        TextSize = 12,
        TextColor3 = Color3.fromRGB(255, 100, 100),
        Font = Enum.Font.Gotham,
        TextXAlignment = Enum.TextXAlignment.Center,
        Parent = KeyPanel
    })
    
    -- Submit logic
    local function checkKey()
        local enteredKey = KeyInput.Text
        local validKey = self.Config.Key
        
        if enteredKey == validKey then
            StatusLabel.Text = "âœ… Key valid! Loading..."
            StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
            task.wait(1)
            KeyGui:Destroy()
            callback(true)
        else
            StatusLabel.Text = "âŒ Invalid key! Try again."
            StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
            KeyInput.Text = ""
        end
    end
    
    SubmitButton.MouseButton1Click:Connect(checkKey)
    KeyInput.FocusLost:Connect(function(enterPressed)
        if enterPressed then
            checkKey()
        end
    end)
    
    -- Hover effect
    SubmitButton.MouseEnter:Connect(function()
        Tween(SubmitButton, {BackgroundColor3 = Color3.fromRGB(230, 230, 230)}, 0.2)
    end)
    SubmitButton.MouseLeave:Connect(function()
        Tween(SubmitButton, {BackgroundColor3 = Color3.fromRGB(255, 255, 255)}, 0.2)
    end)
end

function Loveable:PlayIntroAnimation()
    -- Create intro GUI
    local IntroGui = CreateInstance("ScreenGui", {
        Name = "LoveableIntro",
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        DisplayOrder = 999998,
        Parent = self.ScreenGui.Parent
    })
    
    -- Black Background
    local Background = CreateInstance("Frame", {
        Name = "Background",
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Color3.fromRGB(0, 0, 0),
        BackgroundTransparency = 0,
        BorderSizePixel = 0,
        Parent = IntroGui
    })
    
    -- Title Text
    local TitleText = CreateInstance("TextLabel", {
        Name = "TitleText",
        Size = UDim2.new(0, 400, 0, 50),
        Position = UDim2.new(0.5, 0, 0.45, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundTransparency = 1,
        Text = "Loveable",
        TextSize = 48,
        TextColor3 = Color3.fromRGB(255, 255, 255),
        Font = Enum.Font.GothamBold,
        TextTransparency = 1,
        Parent = Background
    })
    
    -- Loading Bar Background
    local LoadingBarBg = CreateInstance("Frame", {
        Name = "LoadingBarBg",
        Size = UDim2.new(0, 300, 0, 3),
        Position = UDim2.new(0.5, 0, 0.55, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        BackgroundTransparency = 0.9,
        BorderSizePixel = 0,
        Parent = Background
    })
    
    -- Loading Bar Fill
    local LoadingBarFill = CreateInstance("Frame", {
        Name = "LoadingBarFill",
        Size = UDim2.new(0, 0, 1, 0),
        Position = UDim2.new(0, 0, 0, 0),
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        BackgroundTransparency = 0,
        BorderSizePixel = 0,
        Parent = LoadingBarBg
    })
    
    -- ANIMATION SEQUENCE
    task.spawn(function()
        task.wait(0.3)
        
        -- Step 1: Title fades in (0.4s)
        Tween(TitleText, {TextTransparency = 0}, 0.4, Enum.EasingStyle.Quad)
        
        task.wait(0.3)
        
        -- Step 2: Loading bar appears (0.2s)
        Tween(LoadingBarBg, {BackgroundTransparency = 0.9}, 0.2, Enum.EasingStyle.Quad)
        
        task.wait(0.2)
        
        -- Step 3: Loading bar fills (1.2s)
        Tween(LoadingBarFill, {Size = UDim2.new(1, 0, 1, 0)}, 1.2, Enum.EasingStyle.Quad)
        
        task.wait(1.3)
        
        -- Step 4: Everything fades out (0.4s)
        Tween(Background, {BackgroundTransparency = 1}, 0.4, Enum.EasingStyle.Quad)
        Tween(TitleText, {TextTransparency = 1}, 0.4, Enum.EasingStyle.Quad)
        Tween(LoadingBarBg, {BackgroundTransparency = 1}, 0.4, Enum.EasingStyle.Quad)
        Tween(LoadingBarFill, {BackgroundTransparency = 1}, 0.4, Enum.EasingStyle.Quad)
        
        task.wait(0.5)
        
        -- Clean up
        IntroGui:Destroy()
        
        -- Open UI to show apps
        self:Open()
    end)
end

function Loveable:SetupKeybind()
    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if not gameProcessed and input.KeyCode == self.Config.Keybind then
            self:Toggle()
        end
    end)
end

function Loveable:CreateNotification(config)
    local theme = self.Config.Theme
    local notifConfig = {
        Title = config.Title or "Notification",
        Message = config.Message or "",
        Duration = config.Duration or 5,
        Icon = config.Icon or "ðŸ””"
    }
    
    local Notification = CreateInstance("Frame", {
        Name = "Notification",
        Size = UDim2.new(0, 320, 0, 0),
        Position = UDim2.new(1, -340, 1, 20),
        AnchorPoint = Vector2.new(0, 1),
        BackgroundColor3 = theme.PanelBackground,
        BackgroundTransparency = theme.PanelTransparency,
        BorderSizePixel = 0,
        ClipsDescendants = true,
        Parent = self.ScreenGui
    })
    CreateCorner(Notification, 15)
    CreateStroke(Notification, theme.PanelBorder, theme.PanelBorderThickness, theme.PanelBorderTransparency)
    
    local IconBg = CreateInstance("Frame", {
        Name = "IconBg",
        Size = UDim2.new(0, 40, 0, 40),
        Position = UDim2.new(0, 15, 0, 15),
        BackgroundColor3 = theme.AppIconBackground,
        BorderSizePixel = 0,
        Parent = Notification
    })
    CreateCorner(IconBg, 8)
    
    CreateInstance("TextLabel", {
        Name = "IconLabel",
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        Text = notifConfig.Icon,
        TextSize = 20,
        TextColor3 = Color3.fromRGB(200, 200, 200),
        Font = theme.FontRegular,
        Parent = IconBg
    })
    
    CreateInstance("TextLabel", {
        Name = "Title",
        Size = UDim2.new(1, -75, 0, 20),
        Position = UDim2.new(0, 65, 0, 15),
        BackgroundTransparency = 1,
        Text = notifConfig.Title,
        TextSize = 14,
        TextColor3 = Color3.fromRGB(240, 240, 240),
        Font = theme.FontMedium,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd,
        Parent = Notification
    })
    
    local Message = CreateInstance("TextLabel", {
        Name = "Message",
        Size = UDim2.new(1, -75, 0, 16),
        Position = UDim2.new(0, 65, 0, 37),
        BackgroundTransparency = 1,
        Text = notifConfig.Message,
        TextSize = 12,
        TextColor3 = Color3.fromRGB(180, 180, 180),
        Font = theme.FontRegular,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Top,
        TextWrapped = true,
        Parent = Notification
    })
    
    local textHeight = game:GetService("TextService"):GetTextSize(
        notifConfig.Message,
        12,
        theme.FontRegular,
        Vector2.new(Message.AbsoluteSize.X, math.huge)
    ).Y
    local finalHeight = math.max(70, 53 + textHeight)
    
    Tween(
        Notification,
        {Size = UDim2.new(0, 320, 0, finalHeight), Position = UDim2.new(1, -340, 1, -20)},
        0.4,
        Enum.EasingStyle.Back,
        Enum.EasingDirection.Out
    )
    
    task.delay(notifConfig.Duration, function()
        if Notification and Notification.Parent then
            Tween(
                Notification,
                {Position = UDim2.new(1, -340, 1, 20), Size = UDim2.new(0, 320, 0, 0)},
                0.3,
                Enum.EasingStyle.Back,
                Enum.EasingDirection.In
            )
            task.wait(0.3)
            if Notification then
                Notification:Destroy()
            end
        end
    end)
end

function Loveable:StartNotifications(notifications, interval)
    if not notifications or #notifications == 0 then return end
    
    interval = interval or 120
    local currentIndex = 1
    
    if self.NotificationConnection then
        self.NotificationConnection:Disconnect()
    end
    
    -- Send first notification
    self:CreateNotification(notifications[currentIndex])
    currentIndex = currentIndex + 1
    
    self.NotificationConnection = RunService.Heartbeat:Connect(function() end)
    
    task.spawn(function()
        while self.ScreenGui and self.ScreenGui.Parent do
            task.wait(interval)
            if currentIndex > #notifications then
                currentIndex = 1
            end
            self:CreateNotification(notifications[currentIndex])
            currentIndex = currentIndex + 1
        end
    end)
end

function Loveable:Notify(title, message, icon, duration)
    self:CreateNotification({Title = title, Message = message, Icon = icon, Duration = duration})
end

function Loveable:Open()
    if self.Opened then return end
    self.Opened = true
    self.MainFrame.Visible = true
    
    local theme = self.Config.Theme
    Tween(
        self.Panel,
        {Size = UDim2.new(0, theme.PanelWidth, 0, theme.PanelHeight)},
        theme.AnimationDuration,
        theme.AnimationEasing,
        Enum.EasingDirection.Out
    )
    Tween(self.BlurEffect, {Size = 15}, theme.AnimationDuration)
    
    task.wait(theme.AnimationDuration)
    if self.SearchBox then
        self.SearchBox:CaptureFocus()
    end
end

function Loveable:Close()
    if not self.Opened then return end
    self.Opened = false
    
    if self.SearchBox then
        self.SearchBox.Text = ""
        self.SearchBox:ReleaseFocus()
    end
    
    local theme = self.Config.Theme
    Tween(
        self.Panel,
        {Size = UDim2.new(0, 0, 0, 0)},
        theme.AnimationDuration * 0.7,
        theme.AnimationEasing,
        Enum.EasingDirection.In
    )
    Tween(self.BlurEffect, {Size = 0}, theme.AnimationDuration * 0.7)
    
    task.wait(theme.AnimationDuration * 0.7)
    self.MainFrame.Visible = false
end

function Loveable:Toggle()
    if self.Opened then
        self:Close()
    else
        self:Open()
    end
end

-- API Methods
function Loveable:AddApp(appData)
    table.insert(self.Config.Apps, appData)
    self:PopulateApps()
end

function Loveable:RemoveApp(appName)
    for i, app in ipairs(self.Config.Apps) do
        if app.Name == appName then
            table.remove(self.Config.Apps, i)
            self:PopulateApps()
            return true
        end
    end
    return false
end

function Loveable:UpdateApp(appName, newData)
    for i, app in ipairs(self.Config.Apps) do
        if app.Name == appName then
            for key, value in pairs(newData) do
                self.Config.Apps[i][key] = value
            end
            self:PopulateApps()
            return true
        end
    end
    return false
end

function Loveable:AddPage(pageData)
    table.insert(self.Config.Pages, pageData)
end

function Loveable:Destroy()
    if self.BlurEffect then
        self.BlurEffect:Destroy()
    end
    if self.ScreenGui then
        self.ScreenGui:Destroy()
    end
    if self.NotificationConnection then
        self.NotificationConnection:Disconnect()
    end
end

return Loveable
